#!/usr/bin/bash

# Find wallpaper file (any common image extension)
WALLPAPER=$(find ~/.config -maxdepth 1 -name 'wallpaper.*' \( -iname '*.jpg' -o -iname '*.jpeg' -o -iname '*.png' -o -iname '*.webp' -o -iname '*.gif' \) | head -1)

if [[ -z "$WALLPAPER" ]]; then
    notify-send "hyprpaper" "No wallpaper found at ~/.config/wallpaper.*"
    exit 1
fi

# Generate hyprpaper config (preload no longer required in newer versions)
cat > ~/.config/hypr/hyprpaper.conf << EOF
wallpaper = ,$WALLPAPER
EOF

# Check if hyprpaper is running
if ! pgrep -x hyprpaper > /dev/null; then
    hyprpaper &
    sleep 1
fi

# Set wallpaper via IPC (more reliable than config reload)
hyprctl hyprpaper wallpaper ",$WALLPAPER"

notify-send "Wallpaper set" "$(basename "$WALLPAPER")"
